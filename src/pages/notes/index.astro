
<!-- ts-nocheck -->
---
export const prerender = false; 

import Header from '../../components/header/index.astro';
import '../../style/index.css';
import { getSanityPosts } from '../../utils/getSanityPosts';
import { db, reactions, comments } from 'astro:db';
import { eq, and } from '@astrojs/db/dist/runtime/virtual.js';

const posts = await getSanityPosts();

const allReactions = await db.select().from(reactions);
const allComments = await db.select().from(comments);

const reactionCounts: Record<string, number> = {};
const commentCounts: Record<string, number> = {};

allReactions.forEach(r => {
  reactionCounts[r.postId] = (reactionCounts[r.postId] || 0) + 1;
});

allComments.filter(c => c.approved).forEach(c => {
  commentCounts[c.postId] = (commentCounts[c.postId] || 0) + 1;
});
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Personal notes and thoughts on technology, programming, and life" />
  <meta name="author" content="Obiabo" />
  <meta property="og:title" content="Notes" />
  <meta property="og:description" content="Personal notes and thoughts on technology, programming, and life" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Notes" />
  <meta name="twitter:description" content="Personal notes and thoughts on technology, programming, and life" />
  <title>Notes</title>
  <link rel="stylesheet" href="/src/style/index.css" />
</head>
<body>

<Header title="Notes" />
<main class="max-w-4xl mx-auto px-4 py-8">
  <header class="mb-8">
    <h1 class="text-xl font-bold mb-4">
      <span class="text-default text-md">Welcome to my corner of the internet!</span>
    </h1>
    <p class="text-sn italic mb-6">
      This is where I share notes, thoughts, things I've tried and want to try, and personal experiences and learnings.
    </p>
    <p class="mb-8">
      Feel free to explore and learn something along the way.
    </p>
  </header>

  <section class="mb-12">
    <div class="space-y-6 ">
      {posts.map((post: {slug: {current: string}, title: string, description: string, publishedAt: string}) => {
        const postId = post.slug.current;
        const reactionsCount = reactionCounts[postId] || 0;
        const commentsCount = commentCounts[postId] || 0;
        
        return (
          <div class="mt-4">
            <div>
              
              <h3 class="text-md italic font-medium mb-3">
                <a href={`/notes/${post.slug.current}`} class="text-default hover:underline">
                  {post.title}
                </a>
              </h3>
              {post.description && (
                <p class="mb-4 text-sm italic">{post.description}</p>
              )}
              
              <div class="flex items-center gap-4 text-sm text-gray-500">
                <span class="italic">
                  {post.publishedAt ? new Date(post.publishedAt).toLocaleDateString("en-US", { dateStyle: "long" }) : 'Unknown'}
                </span>

              
              
              </div>
              
              <div class="flex items-center gap-3">
                  <span class="flex items-center gap-1">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="32" viewBox="0 0 24 24" fill="none"><path opacity=".4" d="M10.75 2.45c.69-.59 1.82-.59 2.52 0l1.58 1.36c.3.26.86.47 1.26.47h1.7c1.06 0 1.93.87 1.93 1.93v1.7c0 .39.21.96.47 1.26l1.36 1.58c.59.69.59 1.82 0 2.52l-1.36 1.58c-.26.3-.47.86-.47 1.26v1.7c0 1.06-.87 1.93-1.93 1.93h-1.7c-.39 0-.96.21-1.26.47l-1.58 1.36c-.69.59-1.82.59-2.52 0l-1.58-1.36c-.3-.26-.86-.47-1.26-.47H6.18c-1.06 0-1.93-.87-1.93-1.93V16.1c0-.39-.21-.95-.46-1.25l-1.35-1.59c-.58-.69-.58-1.81 0-2.5l1.35-1.59c.25-.3.46-.86.46-1.25V6.21c0-1.06.87-1.93 1.93-1.93h1.73c.39 0 .96-.21 1.26-.47l1.58-1.36Z" fill="#FF8A65"></path><path d="M16.58 11.069c-.19-.27-.51-.42-.89-.42h-1.95c-.13 0-.25-.05-.33-.15a.478.478 0 0 1-.1-.37l.24-1.56c.1-.46-.21-.99-.67-1.14-.43-.16-.94.06-1.14.36l-1.94 2.88v-.36c0-.7-.3-.99-1.04-.99h-.49c-.74 0-1.04.29-1.04.99v4.78c0 .7.3.99 1.04.99h.49c.7 0 1-.27 1.03-.91l1.47 1.13c.2.2.65.31.97.31h1.85c.64 0 1.28-.48 1.42-1.07l1.17-3.56c.13-.32.1-.65-.09-.91Z" fill="#FF8A65"></path></svg>
                  </span>
                  <span>{reactionsCount}</span>
                </span>
                <span class="flex items-center gap-1">
                  <span>
                   <svg xmlns="http://www.w3.org/2000/svg" width="22" height="32" viewBox="0 0 24 24" fill="none"><path opacity=".4" d="M17.98 10.79v4c0 .26-.01.51-.04.75-.23 2.7-1.82 4.04-4.75 4.04h-.4c-.25 0-.49.12-.64.32l-1.2 1.6c-.53.71-1.39.71-1.92 0l-1.2-1.6a.924.924 0 0 0-.64-.32h-.4C3.6 19.58 2 18.79 2 14.79v-4c0-2.93 1.35-4.52 4.04-4.75.24-.03.49-.04.75-.04h6.4c3.19 0 4.79 1.6 4.79 4.79Z" fill="#FF8A65"></path><path d="M9.988 14c-.56 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.44 1-1 1ZM13.488 14c-.56 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1ZM6.5 14c-.56 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1Z" fill="#FF8A65"></path><path d="M21.98 6.79v4c0 2.94-1.35 4.52-4.04 4.75.03-.24.04-.49.04-.75v-4c0-3.19-1.6-4.79-4.79-4.79h-6.4c-.26 0-.51.01-.75.04C6.27 3.35 7.86 2 10.79 2h6.4c3.19 0 4.79 1.6 4.79 4.79Z" fill="#FF8A65"></path></svg>
                  </span>
                  <span>{commentsCount}</span>
                </span>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </section>


  <footer class="mt-12 pt-8  text-center text-sm">
    <p class="text-gray-400">Stay cheesed up for this, drink some cup of water and do the calms</p>
  </footer>
</main>

</body>
</html>